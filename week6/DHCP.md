# DHCP
## 정의
DHCP = `Dynamic Host Configuration Protocol(동적 호스트 구성 프로토콜)` 의 약자
호스트의 IP 주소와 각종 TCP/IP 프로토콜의 기본 설정을 클라이언트에게 자동적으로 제공해주는 네트워크 프로토콜
* 고정 IP의 반대 개념
* 새 장치를 네트워크에 연결하거나 기존 장치의 IP 주소를 변경할 때 사용
* 대부분의 가정용 네트워크에서는 라우터나 공유기가 IP 주소를 장치에 할당하는 DHCP 서버의 역할을 함
  > **라우터와 공유기 차이**
  > * 라우터 : LAN을 연결시켜주는 장치로써 정보를 주고 받을 때 송신정보 (패킷)에 담긴 수신처의 주소를 읽고, 가장 적절한 통신경로를 이용하여 다른 통신망으로 전송하는 장치
  > * 공유기 : 라우터의 많은 기능 중 NAT기능을 특화시켜 만든 저렴한 장비. 사설 IP로 인터넷 사용이 가능하게 하며 허브 기능을 지원

## 구성 요소
### DHCP 서버 
* 일반적으로 서버 또는 라우터, DHCP 서비스에서 실행되는 네트워크 장치
* IP 주소와 구성 관련 정보를 보유
* 컴퓨터에 DHCP 프로그램을 설치해서 DHCP 서버로 만들 수 있음 
### DHCP 클라이언트 
네트워크에 연결하고 DHCP 서버와 통신하는 컴퓨터 또는 전화와 같은 장치 

## DHCP 프로토콜 동작 
![DHCP 프로토콜 동작](https://github.com/CodeSquad-2023-BE-Study/Flytrap-Network-Study/assets/115435482/b20cc030-3496-4fb0-96c2-01abecddfa8e)
1. Discover : 클라이언트가 DHCP 서버를 찾는 과정
   - DHCP 어디있니 이더넷에 브로드캐스팅
2. Offer : Discover 메시지를 수신한 DHCP 서버가 자신을 알리기 위해 응답하는 과정
   * DHCP의 IP주소 응답 + 나 IP 임대해줄 수 있어 응답
   * 클라이언트를 알고 있으므로 유니캐스트로 응답 또는 브로드캐스트 일수도.,. (서버 프로그램마다 다름)
3. Request : 클라이언트가 서버에게 IP 주소를 달라고 요청
4. ACK: 서버가 클라이언트에게 임대해 줄 IP 주소와 임대기간을 응답
> 일부 DHCP 서버에서는 IP 충돌문제를 방지하가 위하여 충돌감지 옵션을 가지고 있음 
> ARP를 이용하여 IP 주소의 사용여부를 한번 더 확인하는 과정을 거침
### 갱신
임대기간이 끝나면 IP 주소를 반환하는데 네트워크를 계속 사용해야한다면 다시 요청하고 할당받기까지 불필요한 브로드캐스팅 패킷이 발생   
임대기간이 50%와 87.5%의 시간이 지났을 때 -> 서버에 갱신을 요청하고 갱신이 성공하면 연장됨   
**Request, Ack 두 개의 과정만 거침**
### 반환
임대기간이 끝났거나, IP 주소를 더 사용하지 않는다면 IP 주소를 DHCP 주소풀에 반환 
## DHCP 임대 시간 제어하기
DHCP 서버의 경우 임대 시간은 장치가 서버에서 할당된 IP 주소를 보유하는 기간 
* 기본 임대 시간은 일반적으로 24시간 -> 물론 제어 가능^^
![](https://github.com/CodeSquad-2023-BE-Study/Flytrap-Network-Study/assets/115435482/6d16f488-99a4-4b71-b8b2-31c30aced0d9)

## DHCP Relay Agent
DHCP 클라이언트와 서버 간의 요청을 관리, 조직이 대규모 또는 복잡한 네트워크를 처리해야 할 때 사용
### 그래서 언제 사용하는데?
기업에서는 DHCP 서버가 라우터 너머 다른 네트워크에 있는 경우가 종종 있는데 이 때 relay agent 를 사용   
* DHCP 요청을 라우터에서 유니캐스트로 변환하여 패킷을 전송 -> 서버는 다시 라우터에게 유니캐스트 -> 라우터는 브로드캐스트하며 할당
  !![](![스크린샷 2023-11-23 오전 8 38 09](https://github.com/CodeSquad-2023-BE-Study/Flytrap-Network-Study/assets/115435482/1035ab40-1783-42cf-8e2f-07f21d680f20)<!-- {"width":690} -->

## DHCP의 장점
* 네트워크 관리자가 해야 할 작업을 간소화
  * 실제 ISP 업체에서는 특정 지억 사용자의 약 70% 정도만 IP를 할당할 수 있게 함 (모든 사람이 동시에 접속할 일 없다고 본다나..)
  * 근데 이걸 관리자가 고정 IP로 관리한다면..? 퇴사다 -> 오류날 가능성 많음 
* 신뢰성 높은 DHCP IP 주소 구성: DHCP는 동일한 IP 주소를 이용하는 두 명의 사용자 사이의 충돌을 방지하도록 도와줍니다. 이러한 충돌이 발생하는 경우 두 명의 사용자 모두 인터넷에 연결하지 못하게 됩니다. DHCP는 자동으로 이러한 충돌을 방지할 수 있다는 장점이 있습니다.
* 높은 이동성
  * 사용자는 네트워크 범위 내에서 어디서든지 모바일 장치 이용 가능
* 효율적인 네트워크 관리
  * DHCP를 사용하면 별도의 IP 할당 서버가 필요하지 않아 네트워크 관리 효율성이 개선
* IP 체계의 유연성
  * DHCP를 이용하면 최종 사용자에게 지장을 주지 않으면서 IP 주소 체계를 손쉽게 변경 가능
## DHCP 보안 문제
DHCP에 보안 문제가 발생할 수 있다는 단점 존재 
DHCP는 아무런 인증 과정을 거치지 않기 때문에 사이버 공격에 취약 
> DHCP로 인해 발생할 수 있는 보안 문제
> * 승인받지 않은 DHCP 서버가 잘못된 정보를 클라이언트에게 제공할 수 있습니다.
> * 승인받지 않은 클라이언트가 DHCP 서버를 가로채 리소스에 대한 접근 권한을 얻을 수도 있습니다.
>* 악성 클라이언트가 DHCP 리소스를 소모시킬 수 있습니다.

## DHCP는 어떤 포트인가요?
DHCP 포트는 DHCP 서버와 클라이언트 간의 통신에 사용되는 UDP 포트 번호   
DHCP 서버는 포트 번호 **67**을 사용하며 이 포트로 주소가 지정된 메시지를 수신 대기   
DHCP 클라이언트는 포트 번호 **68**을 사용하며 이 포트로 전송된 메시지에만 응답   
UDP 포트 번호는 데이터 패킷의 소스 및 대상을 식별하는 데 사용   
